<section class="login-to-account" data-fls-loginsection>
  <div class="login-to-account__content">
    <div class="login-to-account__image-block">
      {% assign img_href = section.settings.image_link | default: '#' %}
      <a href="{{ img_href }}" class="login-to-account__link" {% if img_href == '#' %}aria-disabled="true"{% endif %}>
        {% if section.settings.image %}
          <img class="login-to-account__image ibg"
               src="{{ section.settings.image | img_url: 'master' }}"
               alt="{{ section.settings.heading }}"
               loading="lazy">
        {% else %}
          <img class="login-to-account__image ibg" src="./assets/img/login-and-create-account/image.png" alt="Image" loading="lazy">
        {% endif %}
      </a>
    </div>

    <div data-fls-logintoaccount class="logintoaccount">
      <div class="logintoaccount__content">
        

        {%- comment -%} ===== LOGIN FORM (default Shopify) ===== {%- endcomment -%}
        {%- form 'customer_login', id: 'CustomerLoginForm', class: 'logintoaccount__form form-logintoaccount', novalidate: 'novalidate' -%}
          <h2 class="logintoaccount__title">
          {% if section.settings.heading != blank %}
            {{ section.settings.heading }}
          {% else %}
            {{ 'customer.login_page.title' | t }}
          {% endif %}
        </h2>
			{%- if form.errors -%}
            <div class="form__message">
              <div class="form-status caption-large text-body" role="alert" tabindex="-1" autofocus>
                {{ form.errors | default_errors }}
              </div>
            </div>
          {%- endif -%}

          <div class="form-logintoaccount__line-block">
            <div class="form-logintoaccount__line form-logintoaccount__line--email">
              <label for="CustomerEmail-{{ section.id }}" class="form-logintoaccount__label">
                {{ 'customer.login_page.email' | t }}
              </label>
              <input
                id="CustomerEmail-{{ section.id }}"
                class="form-logintoaccount__input input"
                type="email"
                name="customer[email]"
                autocomplete="email"
                autocapitalize="off"
                spellcheck="false"
                data-fls-input
                placeholder="{{ 'customer.login_page.email' | t }}"
                value="{{ form.email | default: customer.email }}">
            </div>

            <div class="form-logintoaccount__line form-logintoaccount__line--password">
              <label for="CustomerPassword-{{ section.id }}" class="form-logintoaccount__label">
                {{ 'customer.login_page.password' | t }}
              </label>
              <div class="form-logintoaccount__input-password">
                <input
                  id="CustomerPassword-{{ section.id }}"
                  class="form-logintoaccount__input form-logintoaccount__input input"
                  type="password"
                  name="customer[password]"
                  autocomplete="current-password"
                  data-fls-input
                  placeholder="{{ 'customer.login_page.password' | t }}">
                <button data-fls-input-viewpass class="form-logintoaccount__viewpass --icon-hide" type="button" aria-label="Toggle password"></button>
              </div>
            </div>

            <div class="form-logintoaccount__check-and-forgot">
              <div class="form-logintoaccount__checkbox-block">
                <label data-fls-checkbox class="form-logintoaccount__checkbox checkbox">
                  <input class="form-logintoaccount__checkbox-input checkbox__input" type="checkbox" value="1" name="remember" checked>
                  <span class="form-logintoaccount__checkbox-text checkbox__text">{{'customer.login_page.remember_me' | t}}</span>
                </label>
              </div>
              <div class="form-logintoaccount__forgot-block">
                <a href="#recover" class="form-logintoaccount__forgot-link">
                  {{ 'customer.login_page.forgot_password' | t }}
                </a>
              </div>
            </div>

            <div class="form-logintoaccount__button-block">
              <button type="submit" data-fls-button class="form-logintoaccount__button button button--dark">
                {{ 'customer.login_page.sign_in' | t }}
              </button>
            </div>

            <div class="form-logintoaccount__account-block">
              <div class="form-logintoaccount__account-text">{{ 'customer.login_page.dont_account' | t }}</div>
              <a href="{{ routes.account_register_url }}" class="form-logintoaccount__account-link">
                {{ 'customer.login_page.create_account' | t }}
              </a>
            </div>
          </div>
        {%- endform -%}

        {%- comment -%} ===== RECOVER FORM (default Shopify) ===== {%- endcomment -%}
        {%- form 'recover_customer_password', id: 'RecoverCustomerPasswordForm', class: 'recoveraccount__form form-recoveraccount is-hidden', novalidate: 'novalidate' -%}
          <h3 class="logintoaccount__title">{{ 'customer.recover_password.title' | t }}</h3>
          <p class="form__message" style="margin-bottom: 2rem;">{{ 'customer.recover_password.subtext' | t }}</p>

          {%- if form.posted_successfully? -%}
            <div class="form-status form__message" role="status" tabindex="-1" autofocus>
              {{ 'customer.recover_password.success' | t }}
            </div>
          {%- endif -%}

          {%- if form.errors -%}
            <div class="form__message">
              <div class="form-status caption-large text-body" role="alert" tabindex="-1" autofocus>
                {{ form.errors | default_errors }}
              </div>
            </div>
          {%- endif -%}

          <div class="form-logintoaccount__line-block">
            <div class="form-logintoaccount__line form-logintoaccount__line--email">
              <label for="RecoverEmail-{{ section.id }}" class="form-logintoaccount__label">
                {{ 'customer.login_page.email' | t }}
              </label>
              <input
                id="RecoverEmail-{{ section.id }}"
                class="form-logintoaccount__input input"
                type="email"
                name="email"
                autocomplete="email"
                autocapitalize="off"
                spellcheck="false"
                data-fls-input
                placeholder="{{ 'customer.login_page.email' | t }}">
              <div class="form-logintoaccount__forgot-block" style="margin-top:.5rem">
                <a href="#" class="form-recoveraccount__back-link">{{ 'customer.login_page.cancel' | t }}</a>
              </div>
            </div>

            <div class="form-logintoaccount__button-block">
              <button type="submit" data-fls-button class="form-logintoaccount__button button button--dark">
                {{ 'customer.login_page.submit' | t }}
              </button>
            </div>
          </div>
        {%- endform -%}

      </div>
    </div>
  </div>

  <script>
(() => {
  const wrap = document.querySelector('[data-fls-logintoaccount]');
  if (!wrap) return;

  const loginForm    = wrap.querySelector('.form-logintoaccount');
  const recoverForm  = wrap.querySelector('.form-recoveraccount');
  const forgotLink   = wrap.querySelector('.form-logintoaccount__forgot-link');
  const backLink     = wrap.querySelector('.form-recoveraccount__back-link');

  // Remember me
  const emailInput   = loginForm?.querySelector('input[type="email"]');
  const rememberCb   = loginForm?.querySelector('input[name="remember"]');
  const STORAGE_KEY  = 'wmRememberMeEmail';
  const TTL_MS       = 1000 * 60 * 60 * 24 * 30; // 30 днів

  const saveRemember = () => {
    if (!emailInput || !rememberCb) return;
    const email = emailInput.value.trim();
    if (rememberCb.checked && email) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify({ email, ts: Date.now() }));
    } else {
      localStorage.removeItem(STORAGE_KEY);
    }
  };

  const restoreRemember = () => {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return;
      const { email, ts } = JSON.parse(raw);
      if (!email || (Date.now() - ts) > TTL_MS) {
        localStorage.removeItem(STORAGE_KEY);
        return;
      }
      if (emailInput) emailInput.value = email;
      if (rememberCb) rememberCb.checked = true;
    } catch(_) {}
  };

  // Перемикання форм
  const showRecover = () => {
    if (!recoverForm || !loginForm) return;
    loginForm.hidden = true;
    recoverForm.hidden = false;
    recoverForm.querySelector('input[type="email"]')?.focus();
  };

  const showLogin = () => {
    if (!recoverForm || !loginForm) return;
    recoverForm.hidden = true;
    loginForm.hidden = false;
    emailInput?.focus();
  };

  // Події
  forgotLink?.addEventListener('click', (e) => {
    e.preventDefault();
    showRecover();
    history.replaceState(null, '', '#recover');
  });

  backLink?.addEventListener('click', (e) => {
    e.preventDefault();
    showLogin();
    history.replaceState(null, '', location.pathname + location.search);
  });

  // Remember me події
  restoreRemember();
  rememberCb?.addEventListener('change', saveRemember);
  emailInput?.addEventListener('input', () => {
    if (rememberCb?.checked) saveRemember();
  });
  loginForm?.addEventListener('submit', saveRemember); // не блокує сабміт

  showLogin(); // Показує форму логіну при завантаженні сторінки
})();
</script>


</section>


{% schema %}
{
  "name": "Login / Recover",
  "tag": "section",
  "class": "section",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Login to your account" },
    { "type": "image_picker", "id": "image", "label": "Side image" },
    { "type": "url", "id": "image_link", "label": "Side image link (optional)" }
  ],
  "presets": [{ "name": "Login / Recover" }]
}
{% endschema %}
